/**
 * Icon Captcha Plugin: v2.2.1
 * Copyright Â© 2017, Fabian Wennink (https://www.fabianwennink.nl)
 *
 * Licensed under the MIT license: http://www.opensource.org/licenses/mit-license.php
 */
!function(a){a.fn.extend({iconCaptcha:function(c){var t=a.extend({captchaTheme:[""],captchaFontFamily:"",captchaClickDelay:1e3,captchaHoverDetection:!0,showCredits:"show",enableLoadingAnimation:!1,loadingAnimationDelay:2e3,requestIconsDelay:1500,captchaAjaxFile:"../php/captcha-request.php",captchaMessages:{header:"Select the image that does not belong in the row",correct:{top:"Great!",bottom:"You do not appear to be a robot."},incorrect:{top:"Oops!",bottom:"You've selected the wrong image."}}},c);return this.each(function(c){var e=a(this),i=c,s=0,o=!1,n=!1,h=0;function p(c){var s="light";void 0===t.captchaTheme[i]||"dark"!==t.captchaTheme[i]&&"light"!==t.captchaTheme[i]||(s=t.captchaTheme[i].toLowerCase()),h=0,e.addClass("captcha-theme-"+s),n||function(){t.captchaFontFamily?e.css("font-family",t.captchaFontFamily):a("body").append('\x3c!-- Icon Captcha default font --\x3e<link href="https://fonts.googleapis.com/css?family=Roboto:400,500" rel="stylesheet">');var c=[];if(c.push("<div class='captcha-modal'>","<div class='captcha-modal__header'>","<span>"+(t.captchaMessages.header&&t.captchaMessages.header?t.captchaMessages.header:"Select the image that does not belong in the row")+"</span>","</div>","<div class='captcha-modal__icons'>","<div class='captcha-image'></div>","<div class='captcha-image'></div>","<div class='captcha-image'></div>","<div class='captcha-image'></div>","<div class='captcha-image'></div>","</div>"),"show"===t.showCredits||"hide"===t.showCredits){var s="captcha-modal__credits"+("hide"===t.showCredits?" captcha-modal__credits--hide":"");c.push("<div class='"+s+"' title='IconCaptcha by Fabian Wennink'>","<a href='https://www.fabianwennink.nl/projects/IconCaptcha/v2/' target='_blank' rel='follow'>IconCaptcha</a> &copy;","</div>")}c.push("<input type='hidden' name='captcha-hf' required />","<input type='hidden' name='captcha-idhf' value='"+i+"' required />","</div>"),e.html(c.join("")).attr("data-captcha-id",i)}();var o=e.find(".captcha-modal__icons");t.requestIconsDelay&&t.requestIconsDelay>0&&!n?(c||g(o),setTimeout(function(){d(s,o,!0)},t.requestIconsDelay)):d(s,o,c)}function d(o,p,d){a.ajax({url:t.captchaAjaxFile,type:"post",data:{cID:i,rT:1,tM:o},success:function(o){o&&($data=JSON.parse(o),d||g(p),s=new Date,e.find(".captcha-image").each(function(c){var e,s,o,n;a(this).css("background-image","url("+t.captchaAjaxFile+"?cid="+i+"&hash="+$data[c]+")"),a(this).attr("icon-hash",$data[c]),e=a(this),s=p,o=e.css("background-image").match(/\((.*?)\)/)[1].replace(/('|")/g,""),(n=new Image).onload=function(){var a;5===(h+=1)&&s&&((a=s).removeClass("captcha-opacity"),a.find(".captcha-loader").remove())},n.src=o,n.complete&&n.onload()}),n||e.trigger("init",[{captcha_id:c}]),n=!0)},error:function(){console.log(textStatus,errorThrown),l()}})}function r(c){var s=c.attr("icon-hash");s&&(e.find('input[name="captcha-hf"]').attr("value",s),e.find('input[name="captcha-idhf"]').attr("value",i),a.ajax({url:t.captchaAjaxFile,type:"post",data:{cID:i,pC:s,rT:2},success:function(a){"1"===a?(e.find(".captcha-modal__icons").empty(),e.addClass("captcha-success"),e.find(".captcha-modal__icons").html('<div class="captcha-modal__icons-title">'+(t.captchaMessages.correct&&t.captchaMessages.correct.top?t.captchaMessages.correct.top:"Great!")+'</div><div class="captcha-modal__icons-subtitle">'+(t.captchaMessages.correct&&t.captchaMessages.correct.bottom?t.captchaMessages.correct.bottom:"You do not appear to be a robot.")+"</div>"),e.trigger("success",[{captcha_id:i}])):l()},error:function(){l()}}))}function l(){e.find(".captcha-modal__icons").empty(),e.addClass("captcha-error"),e.find(".captcha-modal__icons").html('<div class="captcha-modal__icons-title">'+(t.captchaMessages.incorrect&&t.captchaMessages.incorrect.top?t.captchaMessages.incorrect.top:"Oops!")+'</div><div class="captcha-modal__icons-subtitle">'+(t.captchaMessages.incorrect&&t.captchaMessages.incorrect.bottom?t.captchaMessages.incorrect.bottom:"You've selected the wrong image.")+"</div>"),e.trigger("error",[{captcha_id:i}]),setTimeout(m,3e3)}function m(){e.removeClass("captcha-error"),e.find("input[name='captcha-hf']").attr("value",null),e.find(".captcha-modal__icons").html(["<div class='captcha-loader'></div>","<div class='captcha-image'></div>","<div class='captcha-image'></div>","<div class='captcha-image'></div>","<div class='captcha-image'></div>","<div class='captcha-image'></div>"].join("\n")),e.find(".captcha-modal__icons > .captcha-image").attr("icon-hash",null),p(!0),e.trigger("refreshed",[{captcha_id:i}])}function g(a){a.addClass("captcha-opacity"),a.prepend('<div class="captcha-loader"></div>')}p(!1),e.on("click",".captcha-modal__icons > .captcha-image",function(c){if(!(new Date-s<=t.captchaClickDelay)&&(!t.captchaHoverDetection||o)){var n=c.pageX-a(c.target).offset().left,h=c.pageY-a(c.target).offset().top;if(n&&h){var p=a(this),d=e.find(".captcha-modal__icons");d.hasClass("captcha-opacity")||(e.trigger("selected",[{captcha_id:i}]),!0===t.enableLoadingAnimation?(g(d),setTimeout(function(){r(p)},t.loadingAnimationDelay)):r(p))}}}).on({mouseenter:function(){o||(o=!0)},mouseleave:function(){o&&(o=!1)}},e)})}})}(jQuery);